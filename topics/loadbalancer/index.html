<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.84.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Azure LoadBalancer | Cloud Provider Azure</title><meta name=description content="Cloud Provider Azure"><meta property="og:title" content="Azure LoadBalancer"><meta property="og:description" content="Azure LoadBalancer basics.
"><meta property="og:type" content="article"><meta property="og:url" content="https://cloud-provider-azure.sigs.k8s.io/topics/loadbalancer/"><meta property="article:section" content="topics"><meta property="article:modified_time" content="2022-06-14T12:23:41+08:00"><meta property="og:site_name" content="Cloud Provider Azure"><meta itemprop=name content="Azure LoadBalancer"><meta itemprop=description content="Azure LoadBalancer basics.
"><meta itemprop=dateModified content="2022-06-14T12:23:41+08:00"><meta itemprop=wordCount content="2836"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Azure LoadBalancer"><meta name=twitter:description content="Azure LoadBalancer basics.
"><link rel=preload href=/scss/main.min.77ad8086257c5b04aec72128f0eebde3c7c6696b921b68c53e5e0d3f187d0a84.css as=style><link href=/scss/main.min.77ad8086257c5b04aec72128f0eebde3c7c6696b921b68c53e5e0d3f187d0a84.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="-.17 .08 230.1 223.35"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#326ce5}</style></defs><path d="M134.358 126.466a3.59 3.59.0 00-.855-.065 3.685 3.685.0 00-1.425.37 3.725 3.725.0 00-1.803 4.825l-.026.037 8.528 20.603a43.53 43.53.0 0017.595-22.102l-21.976-3.714zm-34.194 2.92a3.72 3.72.0 00-3.568-2.894 3.656 3.656.0 00-.733.065l-.037-.045-21.785 3.698a43.695 43.695.0 0017.54 21.946l8.442-20.4-.066-.08a3.683 3.683.0 00.207-2.29zm18.245 8a3.718 3.718.0 00-6.557.008h-.018l-10.713 19.372a43.637 43.637.0 0023.815 1.225q2.197-.5 4.292-1.2l-10.738-19.406zm33.914-45-16.483 14.753.009.047a3.725 3.725.0 001.46 6.395l.02.089 21.35 6.15a44.278 44.278.0 00-6.356-27.432zM121.7 94.039a3.725 3.725.0 005.913 2.84l.065.027 18.036-12.788a43.85 43.85.0 00-25.287-12.19l1.253 22.105zm-19.1 2.921a3.72 3.72.0 005.904-2.85l.092-.043 1.253-22.14a44.682 44.682.0 00-4.501.776A43.467 43.467.0 0084.411 84.112l18.154 12.869zm-9.678 16.729a3.72 3.72.0 001.462-6.396l.018-.088-16.574-14.824a43.454 43.454.0 00-6.168 27.51l21.245-6.13zm16.098 6.512 6.114 2.94 6.096-2.934 1.514-6.581-4.219-5.276h-6.79l-4.231 5.268z" class="cls-2"/><path d="M216.208 133.167l-17.422-75.675a13.602 13.602.0 00-7.293-9.073l-70.521-33.67a13.589 13.589.0 00-11.705.0L38.76 48.437a13.598 13.598.0 00-7.295 9.072l-17.394 75.673a13.315 13.315.0 00-.004 5.81 13.506 13.506.0 00.491 1.718 13.1 13.1.0 001.343 2.726c.239.365.491.72.765 1.064l48.804 60.678c.213.264.448.505.681.75a13.423 13.423.0 002.574 2.133 13.924 13.924.0 003.857 1.677 13.298 13.298.0 003.43.473h.759l77.504-.018a12.993 12.993.0 001.41-.083 13.47 13.47.0 001.989-.378 13.872 13.872.0 001.381-.442c.353-.135.705-.27 1.045-.433a13.941 13.941.0 001.479-.822 13.303 13.303.0 003.237-2.865l1.488-1.85 47.299-58.84a13.185 13.185.0 002.108-3.785 13.67 13.67.0 00.5-1.724 13.282 13.282.0 00-.004-5.81zm-73.147 29.432a14.516 14.516.0 00.703 1.703 3.314 3.314.0 00-.327 2.49 39.372 39.372.0 003.742 6.7 35.06 35.06.0 012.263 3.364c.17.315.392.803.553 1.136a4.24 4.24.0 11-7.63 3.607c-.161-.33-.385-.77-.522-1.082a35.275 35.275.0 01-1.225-3.868 39.305 39.305.0 00-2.896-7.097 3.335 3.335.0 00-2.154-1.307c-.135-.233-.635-1.15-.903-1.623a54.617 54.617.0 01-38.948-.1l-.955 1.73a3.429 3.429.0 00-1.819.887 29.517 29.517.0 00-3.268 7.582 34.9 34.9.0 01-1.218 3.868c-.135.31-.361.744-.522 1.073v.009l-.007.008a4.238 4.238.0 11-7.619-3.616c.159-.335.372-.82.54-1.135a35.177 35.177.0 012.262-3.373 41.228 41.228.0 003.82-6.866 4.188 4.188.0 00-.376-2.387l.768-1.84a54.922 54.922.0 01-24.338-30.387l-1.839.313a4.68 4.68.0 00-2.428-.855 39.524 39.524.0 00-7.356 2.165 35.589 35.589.0 01-3.787 1.45c-.305.084-.745.168-1.093.244-.028.01-.052.022-.08.029a.605.605.0 01-.065.006 4.236 4.236.0 11-1.874-8.224l.061-.015.037-.01c.353-.083.805-.2 1.127-.262a35.27 35.27.0 014.05-.326 39.388 39.388.0 007.564-1.242 5.835 5.835.0 001.814-1.83l1.767-.516a54.613 54.613.0 018.613-38.073l-1.353-1.206a4.688 4.688.0 00-.848-2.436 39.366 39.366.0 00-6.277-4.41 35.25 35.25.0 01-3.499-2.046c-.256-.191-.596-.478-.874-.704l-.063-.044a4.473 4.473.0 01-1.038-6.222 4.066 4.066.0 013.363-1.488 5.03 5.03.0 012.942 1.11c.287.225.68.526.935.745a35.253 35.253.0 012.78 2.95 39.383 39.383.0 005.69 5.142 3.333 3.333.0 002.507.243q.754.55 1.522 1.082A54.289 54.289.0 01102.86 61.89a55.052 55.052.0 017.63-1.173l.1-1.784a4.6 4.6.0 001.37-2.184 39.476 39.476.0 00-.47-7.654 35.466 35.466.0 01-.576-4.014c-.011-.307.006-.731.01-1.081.0-.04-.01-.08-.01-.118a4.242 4.242.0 118.441-.004c0 .37.022.86.009 1.2a35.109 35.109.0 01-.579 4.013 39.533 39.533.0 00-.478 7.656 3.344 3.344.0 001.379 2.11c.015.305.065 1.323.102 1.884a55.309 55.309.0 0135.032 16.927l1.606-1.147a4.69 4.69.0 002.56-.278 39.532 39.532.0 005.69-5.148 35.004 35.004.0 012.787-2.95c.259-.222.65-.52.936-.746a4.242 4.242.0 115.258 6.598c-.283.229-.657.548-.929.75a35.095 35.095.0 01-3.507 2.046 39.495 39.495.0 00-6.277 4.41 3.337 3.337.0 00-.792 2.39c-.235.216-1.06.947-1.497 1.343a54.837 54.837.0 018.792 37.983l1.704.496a4.745 4.745.0 001.82 1.83 39.464 39.464.0 007.568 1.246 35.64 35.64.0 014.046.324c.355.065.868.207 1.23.29a4.236 4.236.0 11-1.878 8.223l-.061-.008c-.028-.007-.054-.022-.083-.03-.348-.075-.785-.151-1.09-.231a35.14 35.14.0 01-3.785-1.462 39.477 39.477.0 00-7.363-2.165 3.337 3.337.0 00-2.362.877q-.9-.171-1.804-.316a54.92 54.92.0 01-24.328 30.605z" class="cls-2"/><path d="M225.407 135.107 206.4 52.547a14.838 14.838.0 00-7.958-9.9l-76.935-36.73a14.825 14.825.0 00-12.771.0L31.808 42.669a14.838 14.838.0 00-7.961 9.895L4.873 135.129a14.668 14.668.0 001.995 11.185c.261.4.538.788.838 1.162l53.246 66.205a14.98 14.98.0 0011.499 5.487l85.387-.02a14.986 14.986.0 0011.5-5.48l53.227-66.211a14.72 14.72.0 002.842-12.347zm-9.197 3.866a13.677 13.677.0 01-.498 1.723 13.184 13.184.0 01-2.11 3.786l-47.299 58.838-1.486 1.852a13.305 13.305.0 01-3.24 2.865 13.945 13.945.0 01-1.474.822q-.513.237-1.045.43a13.873 13.873.0 01-1.383.445 13.473 13.473.0 01-1.989.379 12.988 12.988.0 01-1.41.082l-77.504.018h-.76a13.298 13.298.0 01-3.429-.472 13.925 13.925.0 01-3.855-1.679 13.424 13.424.0 01-2.576-2.132c-.233-.246-.468-.487-.68-.75l-48.805-60.679q-.408-.514-.765-1.066a13.102 13.102.0 01-1.343-2.726 13.505 13.505.0 01-.491-1.719 13.315 13.315.0 01.004-5.809l17.394-75.675a13.598 13.598.0 017.295-9.07l70.508-33.685a13.589 13.589.0 0111.705.0l70.519 33.67a13.602 13.602.0 017.293 9.073l17.422 75.674a13.282 13.282.0 01.002 5.807z" class="cls-1"/><path d="M185.814 127.106c-.36-.083-.874-.225-1.227-.29a35.642 35.642.0 00-4.046-.326 39.464 39.464.0 01-7.57-1.242 4.745 4.745.0 01-1.82-1.832l-1.704-.496a54.837 54.837.0 00-8.79-37.983c.436-.396 1.262-1.127 1.495-1.342a3.338 3.338.0 01.792-2.39 39.495 39.495.0 016.277-4.41 35.095 35.095.0 003.507-2.046c.272-.202.644-.522.929-.75a4.242 4.242.0 10-5.256-6.6c-.288.227-.68.525-.936.747a35.004 35.004.0 00-2.789 2.95 39.533 39.533.0 01-5.69 5.148 4.69 4.69.0 01-2.56.278l-1.606 1.147a55.309 55.309.0 00-35.032-16.927c-.039-.561-.087-1.577-.102-1.884a3.344 3.344.0 01-1.377-2.11 39.533 39.533.0 01.478-7.656 35.112 35.112.0 00.575-4.012c.013-.34-.007-.834-.007-1.201a4.242 4.242.0 10-8.441.004c0 .04.009.078.01.118-.004.35-.021.774-.01 1.08a35.476 35.476.0 00.576 4.015 39.475 39.475.0 01.47 7.654 4.601 4.601.0 01-1.37 2.182l-.1 1.786a55.052 55.052.0 00-7.63 1.173A54.289 54.289.0 0075.286 77.645q-.77-.531-1.526-1.082a3.333 3.333.0 01-2.506-.243 39.383 39.383.0 01-5.69-5.141 35.255 35.255.0 00-2.777-2.95c-.257-.22-.65-.52-.938-.75a5.03 5.03.0 00-2.942-1.11 4.066 4.066.0 00-3.363 1.49 4.473 4.473.0 001.038 6.222l.065.046c.276.226.616.515.872.702a35.256 35.256.0 003.499 2.048 39.367 39.367.0 016.276 4.412 4.69 4.69.0 01.849 2.434l1.351 1.208a54.613 54.613.0 00-8.611 38.073l-1.767.514a5.835 5.835.0 01-1.814 1.827 39.39 39.39.0 01-7.565 1.247 35.266 35.266.0 00-4.049.326c-.324.06-.774.174-1.127.262l-.037.008-.06.018a4.236 4.236.0 101.875 8.224l.063-.01c.028-.006.052-.02.08-.025.348-.08.786-.163 1.092-.246a35.59 35.59.0 003.786-1.451 39.527 39.527.0 017.358-2.165 4.68 4.68.0 012.426.857l1.84-.315a54.922 54.922.0 0024.34 30.387l-.769 1.84a4.188 4.188.0 01.377 2.387 41.228 41.228.0 01-3.82 6.864 35.183 35.183.0 00-2.263 3.372c-.168.318-.381.805-.542 1.138a4.238 4.238.0 107.621 3.616l.007-.008v-.01c.16-.33.387-.763.522-1.072a34.903 34.903.0 001.218-3.868 29.517 29.517.0 013.268-7.582 3.43 3.43.0 011.819-.888l.957-1.73a54.617 54.617.0 0038.946.099c.268.478.768 1.392.9 1.623a3.335 3.335.0 012.155 1.31 39.306 39.306.0 012.898 7.096 35.275 35.275.0 001.225 3.868c.137.312.36.75.522 1.082a4.24 4.24.0 107.63-3.607c-.161-.333-.383-.82-.55-1.136a35.06 35.06.0 00-2.263-3.364 39.372 39.372.0 01-3.742-6.7 3.314 3.314.0 01.324-2.49 14.519 14.519.0 01-.703-1.703 54.92 54.92.0 0024.328-30.605c.546.087 1.497.253 1.806.316a3.337 3.337.0 012.36-.877 39.476 39.476.0 017.36 2.165 35.135 35.135.0 003.788 1.462c.305.08.74.156 1.09.233.029.008.055.02.083.028l.06.009a4.236 4.236.0 101.878-8.224zm-40.1-42.987-18.037 12.787-.063-.03a3.723 3.723.0 01-5.913-2.838l-.02-.01-1.253-22.103a43.85 43.85.0 0125.285 12.194zm-33.978 24.228h6.788l4.22 5.276-1.513 6.58-6.096 2.934-6.114-2.94-1.516-6.583zm-6.386-35.648a44.672 44.672.0 014.503-.774l-1.255 22.137-.092.044a3.72 3.72.0 01-5.904 2.852l-.035.02-18.154-12.872a43.467 43.467.0 0120.937-11.407zm-27.52 19.68 16.574 14.824-.018.09a3.72 3.72.0 01-1.462 6.395l-.017.072-21.245 6.13a43.454 43.454.0 016.168-27.51zm22.191 39.38-8.441 20.397a43.696 43.696.0 01-17.536-21.948l21.783-3.7.037.049a3.655 3.655.0 01.73-.065 3.72 3.72.0 013.364 5.185zm24.916 26.23a43.637 43.637.0 01-23.815-1.223l10.713-19.372h.018a3.725 3.725.0 016.557-.006h.08l10.74 19.404q-2.091.698-4.293 1.199zm13.841-5.751-8.528-20.605.026-.037a3.725 3.725.0 011.803-4.823 3.685 3.685.0 011.425-.37 3.59 3.59.0 01.855.063l.037-.046 21.977 3.714a43.53 43.53.0 01-17.595 22.105zm19.903-32.42-21.352-6.15-.02-.09a3.725 3.725.0 01-1.46-6.395l-.008-.043 16.482-14.751a44.279 44.279.0 016.357 27.43z" class="cls-1"/></svg></span><span class="text-uppercase font-weight-bold">Cloud Provider Azure</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/install/><span>Installation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/development/><span>Development</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/topics/><span class=active>Topics</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/contribute/><span>Contribution</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/example/><span>Example</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>Release Notes</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/faq/><span>FAQ</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.f62ee3a476a13f18ebde1369b4ab7e26.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.f62ee3a476a13f18ebde1369b4ab7e26.json data-offline-search-base-href=/ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-topics-li><a href=/topics/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-topics><span>Topics</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-topicsassumptions-li><a href=/topics/assumptions/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-topicsassumptions><span>Cluster Provisioning Tools Contract</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-topicsloadbalancer-li><a href=/topics/loadbalancer/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-topicsloadbalancer><span class=td-sidebar-nav-active-item>Azure LoadBalancer</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-topicsazure-permissions-li><a href=/topics/azure-permissions/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-topicsazure-permissions><span>Azure Permissions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-topicsavailability-zones-li><a href=/topics/availability-zones/ title="Use Availability Zones" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-topicsavailability-zones><span>Availability Zones</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-topicscross-resource-group-nodes-li><a href=/topics/cross-resource-group-nodes/ title="Deploy Cross Resource Group Nodes" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-topicscross-resource-group-nodes><span>Cross Resource Group Nodes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-topicsshared-ip-li><a href=/topics/shared-ip/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-topicsshared-ip><span>Multiple Services Sharing One IP Address</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-topicstagging-resources-li><a href=/topics/tagging-resources/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-topicstagging-resources><span>Tagging resources managed by Cloud Provider Azure</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-topicscredential-provider-li><a href=/topics/credential-provider/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-topicscredential-provider><span>Kubelet Credential Provider</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-topicsipam-li><a href=/topics/ipam/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-topicsipam><span>Node IPAM controller</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-topicspls-integration-li><a href=/topics/pls-integration/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-topicspls-integration><span>Azure Private Link Service Integration</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/kubernetes-sigs/cloud-provider-azure/edit/master/site/content/en/topics/loadbalancer.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/kubernetes-sigs/cloud-provider-azure/new/master/site/content/en/topics/loadbalancer.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/kubernetes-sigs/cloud-provider-azure/issues/new?title=Azure%20LoadBalancer" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/kubernetes-sigs/cloud-provider-azure/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#loadbalancer-annotations>LoadBalancer annotations</a><ul><li><a href=#load-balancer-selection-modes>Load balancer selection modes</a></li></ul></li><li><a href=#loadbalancer-skus>LoadBalancer SKUs</a><ul><li><a href=#outbound-connectivity>Outbound connectivity</a></li><li><a href=#standard-loadbalancer>Standard LoadBalancer</a></li></ul></li><li><a href=#exclude-nodes-from-the-load-balancer>Exclude nodes from the load balancer</a></li><li><a href=#using-sctp>Using SCTP</a></li><li><a href=#multiple-standard-loadbalancer-per-cluster>Multiple Standard LoadBalancer per cluster</a><ul><li><a href=#choose-which-slb-to-use>Choose which SLB to use</a></li><li><a href=#outbound-connections-of-non-primary-vmssvmas>Outbound Connections of non-primary VMSS/VMAS</a></li><li><a href=#sharing-the-primary-slb-with-multiple-vmssvmas>Sharing the primary SLB with multiple VMSS/VMAS</a></li></ul></li><li><a href=#custom-load-balancer-health-probe>Custom Load Balancer health probe</a><ul><li><a href=#custom-load-balancer-health-probe-for-port>Custom Load Balancer health probe for port</a></li></ul></li><li><a href=#configure-load-balancer-backend>Configure Load Balancer backend</a></li><li><a href=#load-balancer-limits>Load balancer limits</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=https://cloud-provider-azure.sigs.k8s.io/topics/>Topics</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://cloud-provider-azure.sigs.k8s.io/topics/loadbalancer/>Azure LoadBalancer</a></li></ol></nav><div class=td-content><h1>Azure LoadBalancer</h1><div class=lead>Azure LoadBalancer basics.</div><header class=article-meta></header><p>The way Azure defines a LoadBalancer is different from GCE or AWS. Azure&rsquo;s LB can have multiple frontend IP refs. GCE and AWS only allow one, if you want more, you would need multiple LBs. Since Public IP&rsquo;s are not part of the LB in Azure, an NSG is not part of the LB in Azure either. However, you cannot delete them in parallel, a Public IP can only be deleted after the LB&rsquo;s frontend IP ref is removed.</p><p>The different Azure Resources such as LB, Public IP, and NSG are the same tier of Azure resources and circular dependencies need to be avoided. In other words, they should only depend on service state.</p><p>By default the basic SKU is selected for a load balancer. Services can be annotated to allow auto selection of available load balancers. Service annotations can also be used to provide specific availability sets that host the load balancers. Note that in case of auto selection or specific availability set selection, services are currently not auto-reassigned to an available loadbalancer when the availability set is lost in case of downtime or cluster scale down.</p><h2 id=loadbalancer-annotations>LoadBalancer annotations</h2><p>Below is a list of annotations supported for Kubernetes services with type <code>LoadBalancer</code>:</p><table><thead><tr><th>Annotation</th><th>Value</th><th>Description</th><th>Kubernetes Version</th></tr></thead><tbody><tr><td><code>service.beta.kubernetes.io/azure-load-balancer-internal</code></td><td><code>true</code> or <code>false</code></td><td>Specify whether the load balancer should be internal. It’s defaulting to public if not set.</td><td>v1.10.0 and later</td></tr><tr><td><code>service.beta.kubernetes.io/azure-load-balancer-internal-subnet</code></td><td>Name of the subnet</td><td>Specify which subnet the internal load balancer should be bound to. It’s defaulting to the subnet configured in cloud config file if not set.</td><td>v1.10.0 and later</td></tr><tr><td><code>service.beta.kubernetes.io/azure-load-balancer-mode</code></td><td><code>auto</code>, <code>{vmset-name}</code></td><td>Specify the Azure load balancer selection algorithm based on vm sets (VMSS or VMAS). There are currently three possible load balancer selection modes : default, auto or &ldquo;{vmset-name}&rdquo;. This is only working for basic LB or multiple standard LB (see below for how it works)</td><td>v1.10.0 and later</td></tr><tr><td><code>service.beta.kubernetes.io/azure-dns-label-name</code></td><td>Name of the PIP DNS label</td><td>Specify the DNS label name for the service&rsquo;s public IP address (PIP). If it is set to empty string, DNS in PIP would be deleted. Because of a bug, before v1.15.10/v1.16.7/v1.17.3, the DNS label on PIP would also be deleted if the annotation is not specified.</td><td>v1.15.0 and later</td></tr><tr><td><code>service.beta.kubernetes.io/azure-shared-securityrule</code></td><td><code>true</code> or <code>false</code></td><td>Specify that the service should be exposed using an Azure security rule that may be shared with another service, trading specificity of rules for an increase in the number of services that can be exposed. This relies on the Azure &ldquo;augmented security rules&rdquo; feature.</td><td>v1.10.0 and later</td></tr><tr><td><code>service.beta.kubernetes.io/azure-load-balancer-resource-group</code></td><td>Name of the PIP resource group</td><td>Specify the resource group of the service&rsquo;s PIP that are not in the same resource group as the cluster.</td><td>v1.10.0 and later</td></tr><tr><td><code>service.beta.kubernetes.io/azure-allowed-service-tags</code></td><td>List of allowed service tags</td><td>Specify a list of allowed <a href=https://docs.microsoft.com/en-us/azure/virtual-network/security-overview#service-tags>service tags</a> separated by comma.</td><td>v1.11.0 and later</td></tr><tr><td><code>service.beta.kubernetes.io/azure-load-balancer-tcp-idle-timeout</code></td><td>TCP idle timeouts in minutes</td><td>Specify the time, in minutes, for TCP connection idle timeouts to occur on the load balancer. Default and minimum value is 4. Maximum value is 30. Must be an integer.</td><td>v1.11.4, v1.12.0 and later</td></tr><tr><td><code>service.beta.kubernetes.io/azure-pip-name</code></td><td>Name of PIP</td><td>Specify the PIP that will be applied to load balancer.</td><td>v1.16 and later</td></tr><tr><td><code>service.beta.kubernetes.io/azure-pip-prefix-id</code></td><td>ID of Public IP Prefix</td><td>Specify the Public IP Prefix that will be applied to load balancer.</td><td>v1.21 and later with out-of-tree cloud provider</td></tr><tr><td><code>service.beta.kubernetes.io/azure-pip-tags</code></td><td>Tags of the PIP</td><td>Specify the tags of the PIP that will be associated to the load balancer typed service. <a href=../tagging-resources>Doc</a></td><td>v1.20 and later</td></tr><tr><td><code>service.beta.kubernetes.io/azure-load-balancer-health-probe-interval</code></td><td>Health probe interval</td><td>Refer to the detailed docs <a href=#custom-load-balancer-health-probe>here</a></td><td>v1.21 and later with out-of-tree cloud provider</td></tr><tr><td><code>service.beta.kubernetes.io/azure-load-balancer-health-probe-num-of-probe</code></td><td>The minimum number of unhealthy responses of health probe</td><td>Refer to the detailed docs <a href=#custom-load-balancer-health-probe>here</a></td><td>v1.21 and later with out-of-tree cloud provider</td></tr><tr><td><code>service.beta.kubernetes.io/azure-load-balancer-health-probe-request-path</code></td><td>Request path of the health probe</td><td>Refer to the detailed docs <a href=#custom-load-balancer-health-probe>here</a></td><td>v1.20 and later with out-of-tree cloud provider</td></tr><tr><td><code>service.beta.kubernetes.io/port_{port}_health-probe_interval</code></td><td>Health probe interval</td><td>{port} is port number of service. Refer to the detailed docs <a href=#custom-load-balancer-health-probe>here</a></td><td>v1.21 and later with out-of-tree cloud provider</td></tr><tr><td><code>service.beta.kubernetes.io/port_{port}_health-probe_num-of-probe</code></td><td>The minimum number of unhealthy responses of health probe</td><td>{port} is port number of service. Refer to the detailed docs <a href=#custom-load-balancer-health-probe>here</a></td><td>v1.21 and later with out-of-tree cloud provider</td></tr><tr><td><code>service.beta.kubernetes.io/port_{port}_health-probe_request-path</code></td><td>Request path of the health probe</td><td>{port} is port number of service. Refer to the detailed docs <a href=#custom-load-balancer-health-probe>here</a></td><td>v1.20 and later with out-of-tree cloud provider</td></tr><tr><td><code>service.beta.kubernetes.io/azure-load-balancer-enable-high-availability-ports</code></td><td>Enable <a href=https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-ha-ports-overview>high availability ports</a> on internal SLB</td><td>HA ports is required when applications require IP fragments</td><td>v1.20 and later</td></tr><tr><td><code>service.beta.kubernetes.io/azure-deny-all-except-load-balancer-source-ranges</code></td><td><code>true</code> or <code>false</code></td><td>Deny all traffic to the service. This is helpful when the <code>service.Spec.LoadBalancerSourceRanges</code> is set to an internal load balancer typed service. When set the loadBalancerSourceRanges field on the service in order to whitelist ip src addresses, although the generated NSG has added the rules for loadBalancerSourceRanges, the default rule (65000) will allow any vnet traffic, basically meaning the whitelist is of no use. This annotation solves this issue.</td><td>v1.21 and later</td></tr><tr><td><code>service.beta.kubernetes.io/azure-additional-public-ips</code></td><td>External public IPs besides the service&rsquo;s own public IP</td><td>It is mainly used for global VIP on Azure cross-region LoadBalancer</td><td>v1.20 and later with out-of-tree cloud provider</td></tr></tbody></table><p>Please note that</p><ul><li>When <code>loadBalancerSourceRanges</code> have been set on service spec, <code>service.beta.kubernetes.io/azure-allowed-service-tags</code> won&rsquo;t work because of DROP iptables rules from kube-proxy. The CIDRs from service tags should be merged into <code>loadBalancerSourceRanges</code> to make it work.</li></ul><h3 id=load-balancer-selection-modes>Load balancer selection modes</h3><p>There are currently three possible load balancer selection modes :</p><ol><li>Default mode - service has no annotation (&ldquo;service.beta.kubernetes.io/azure-load-balancer-mode&rdquo;). In this case the Loadbalancer of the primary Availability set is selected</li><li>&ldquo;<strong>auto</strong>&rdquo; mode - service is annotated with <code>__auto__</code> value. In this case, services would be associated with the Loadbalancer with the minimum number of rules.</li><li>&ldquo;{vmset-name}&rdquo; mode - service is annotated with the name of a VMSS/VMAS. In this case, only load balancers of the specified VMSS/VMAS would be selected, and services would be associated with the one with the minimum number of rules.</li></ol><blockquote><p>Note that the &ldquo;<strong>auto</strong>&rdquo; mode is valid only if the service is newly created. It is not allowed to change the annotation value to <code>__auto__</code> of an existed service.</p></blockquote><p>The selection mode for a load balancer only works for basic load balancers or multiple standard load balancers. Following is the detailed information of allowed number of VMSS/VMAS in a load balancer.</p><ul><li>Standard SKU supports any virtual machine in a single virtual network, including a mix of virtual machines, availability sets, and virtual machine scale sets. So all the nodes would be added to the same standard LB backend pool with a max size of 1000.</li><li>Basic SKU only supports virtual machines in a single availability set, or a virtual machine scale set. Only nodes with the same availability set or virtual machine scale set would be added to the basic LB backend pool.</li></ul><h2 id=loadbalancer-skus>LoadBalancer SKUs</h2><p>Azure cloud provider supports both <code>basic</code> and <code>standard</code> SKU load balancers, which can be set via <code>loadBalancerSku</code> option in <a href=../../install/configs>cloud config file</a>. A list of differences between these two SKUs can be found <a href=https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-standard-overview#why-use-standard-load-balancer>here</a>.</p><blockquote><p>Note that the public IPs used in load balancer frontend configurations should be the same SKU. That is a standard SKU public IP for standard load balancer and a basic SKU public IP for a basic load balancer.</p></blockquote><p>Azure doesn’t support a network interface joining load balancers with different SKUs, hence migration dynamically between them is not supported.</p><blockquote><p>If you do require migration, please delete all services with type <code>LoadBalancer</code> (or change to other type)</p></blockquote><h3 id=outbound-connectivity>Outbound connectivity</h3><p><a href=https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-connections>Outbound connectivity</a> is also different between the two load balancer SKUs:</p><ul><li><p>For the basic SKU, the outbound connectivity is opened by default. If multiple frontends are set, then the outbound IP is selected randomly (and configurable) from them.</p></li><li><p>For the standard SKU, the outbound connectivity is disabled by default. There are two ways to open the outbound connectivity: use a standard public IP with the standard load balancer or define outbound rules.</p></li></ul><h3 id=standard-loadbalancer>Standard LoadBalancer</h3><p>Because the load balancer in a Kubernetes cluster is managed by the Azure cloud provider, and it may change dynamically (e.g. the public load balancer would be deleted if no services defined with type <code>LoadBalancer</code>), <a href=https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-rules-overview>outbound rules</a> are the recommended path if you want to ensure the outbound connectivity for all nodes.</p><blockquote><p>Especially note:</p><ul><li><p>In the context of outbound connectivity, a single standalone VM, all the VM&rsquo;s in an Availability Set, all the instances in a VMSS behave as a group. This means, if a single VM in an Availability Set is associated with a Standard SKU, all VM instances within this Availability Set now behave by the same rules as if they are associated with Standard SKU, even if an individual instance is not directly associated with it.</p></li><li><p>Public IP&rsquo;s used as instance-level public IP are mutually exclusive with outbound rules.</p></li></ul></blockquote><p>Here is the recommended way to define the <a href=https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-rules-overview>outbound rules</a> when using separate provisioning tools:</p><ul><li>Create a separate IP (or multiple IPs for scale) in a standard SKU for outbound rules. Make use of the <a href=https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-rules-overview#snatports>allocatedOutboundPorts</a> parameter to allocate sufficient ports for your desired scenario scale.</li><li>Create a separate pool definition for outbound, and ensure all virtual machines or VMSS virtual machines are in this pool. Azure cloud provider will manage the load balancer rules with another pool, so that provisioning tools and the Azure cloud provider won&rsquo;t affect each other.</li><li>Define inbound with load balancing rules and inbound NAT rules as needed, and set <code>disableOutboundSNAT</code> to true on the load balancing rule(s). Don&rsquo;t rely on the side effect from these rules for outbound connectivity. It makes it messier than it needs to be and limits your options. Use inbound NAT rules to create port forwarding mappings for SSH access to the VM&rsquo;s rather than burning public IPs per instance.</li></ul><h2 id=exclude-nodes-from-the-load-balancer>Exclude nodes from the load balancer</h2><blockquote><p>Excluding nodes from Azure LoadBalancer is supported since v1.20.0.</p></blockquote><p>The kubernetes controller manager supports excluding nodes from the load balancer backend pools by enabling the feature gate <code>ServiceNodeExclusion</code>. To exclude nodes from Azure LoadBalancer, label <code>node.kubernetes.io/exclude-from-external-load-balancers=true</code> should be added to the nodes.</p><ol><li><p>To use the feature, the feature gate <code>ServiceNodeExclusion</code> should be on (enabled by default since its beta on v1.19).</p></li><li><p>The labeled nodes would be excluded from the LB in the next LB reconcile loop, which needs one or more LB typed services to trigger. Basically, users could trigger the update by creating a service. If there are one or more LB typed services existing, no extra operations are needed.</p></li><li><p>To re-include the nodes, just remove the label and the update would be operated in the next LB reconcile loop.</p></li></ol><h2 id=using-sctp>Using SCTP</h2><p>SCTP protocol services are only supported on internal standard LoadBalancer, hence annotation <code>service.beta.kubernetes.io/azure-load-balancer-internal: "true"</code> should be added to SCTP protocol services. See below for an example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Service</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sctpservice</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>service.beta.kubernetes.io/azure-load-balancer-internal</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LoadBalancer</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sctpserver</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sctpserver</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>protocol</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SCTP</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>30102</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>targetPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>30102</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><h2 id=multiple-standard-loadbalancer-per-cluster>Multiple Standard LoadBalancer per cluster</h2><blockquote><p>This feature is supported since v1.20.0.</p></blockquote><p>There is only one external and one internal Standard Load Balancer (SLB) at most per cluster. Set <code>enableMultipleStandardLoadBalancers=true</code> in the cloud config if you want to turn on the multiple SLB mode. Similar to the basic LB, there will be a 1:1 mapping between each SLB and VMSS/VMAS. The SLB of the primary VMSS/VMAS will be named after <code>clusterName</code> in the cloud config (in AKS, it would be <code>kubernetes</code>) while the name of those belonging to non-primary VMSS/VMAS will be the name of the corresponding vmSet.</p><blockquote><p>If the cluster provisioning tools like ASK-Engine and CAPZ don&rsquo;t proactively create a dedicated SLB for each VMSS/VMAS when enabling multiple SLB, only the primary SLB would be created. You could manually trigger the creation by setting the service annotation <code>service.beta.kubernetes.io/azure-load-balancer-mode</code> to bind the service to that VMSS/VMAS. The dedicated SLB would be created once the service reconcile loop is done. Unlike the primary SLB, there is no default outbound rules/IPs for the non-primary SLBs. That means the SLB would be deleted once all the services referencing it are deleted.</p></blockquote><h3 id=choose-which-slb-to-use>Choose which SLB to use</h3><p>The service annotation <code>service.beta.kubernetes.io/azure-load-balancer-mode</code> will be respected as long as <code>enableMultipleStandardLoadBalancers=true</code> when using standard LB, and the usage is the same as it is in the basic LB clusters. Specifically, there are three selection mode: <code>default</code> to select the primary SLB; <code>__auto__</code> to select the SLB with minimum rules and <code>vmSetName</code> to select the dedicated SLB of that VMSS/VMAS.</p><h3 id=outbound-connections-of-non-primary-vmssvmas>Outbound Connections of non-primary VMSS/VMAS</h3><p>The outbound rules of the non-primary SLB are not managed by cloud provider azure. Instead, it should be managed by cluster provisioning tools. For now, there is no outbound configuration for the non-primary VMSS/VMAS, but we plan to support customized outbound configurations in AKS and CAPZ in the future.</p><h3 id=sharing-the-primary-slb-with-multiple-vmssvmas>Sharing the primary SLB with multiple VMSS/VMAS</h3><blockquote><p>This feature is supported since v1.21.0</p></blockquote><p>For each non-primary VMSS/VMAS, one can determine to use dedicated SLB or share the primary SLB. If the VMSS/VMAS names are in the cloud config <code>nodepoolsWithoutDedicatedSLB</code>, those would join the backend pool of the primary SLB while the others would remain to have dedicated SLBs. If the VMSS/VMAS supposed to share the primary SLB owns a dedicated SLB, the dedicated one would be deleted, and the VMSS/VMAS would be joint the primary SLB&rsquo;s backend pool.</p><h2 id=custom-load-balancer-health-probe>Custom Load Balancer health probe</h2><p>As documented <a href=https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-custom-probe-overview>here</a>, Tcp, Http and Https are three protocols supported by load balancer service.</p><p>Currently, the default protocol of the health probe varies among services with different transport protocols, app protocols, annotations and external traffic policies.</p><ol><li>for local services, HTTP and /healthz would be used. The health probe will query NodeHealthPort rather than actual backend service</li><li>for cluster TCP services, TCP would be used.</li><li>for cluster UDP services, no health probes.</li></ol><p>Since v1.20, service annotation <code>service.beta.kubernetes.io/azure-load-balancer-health-probe-request-path</code> is introduced to determine the health probe behavior.</p><ul><li>For clusters &lt;=1.23, <code>spec.ports.appProtocol</code> would only be used as probe protocol when <code>service.beta.kubernetes.io/azure-load-balancer-health-probe-request-path</code> is also set.</li><li>For clusters >1.24, <code>spec.ports.appProtocol</code> would be used as probe protocol and <code>/</code> would be used as default probe request path (<code>service.beta.kubernetes.io/azure-load-balancer-health-probe-request-path</code> could be used to change to a different request path).</li></ul><p>Note that the request path would be ignored when using TCP or the <code>spec.ports.appProtocol</code> is empty. More specifically:</p><table><thead><tr><th>loadbalancer sku</th><th><code>externalTrafficPolicy</code></th><th>spec.ports.Protocol</th><th>spec.ports.AppProtocol</th><th><code>service.beta.kubernetes.io/azure-load-balancer-health-probe-request-path</code></th><th>LB Probe Protocol</th><th>LB Probe Request Path</th></tr></thead><tbody><tr><td>standard</td><td>local</td><td>any</td><td>any</td><td>any</td><td>http</td><td><code>/healthz</code></td></tr><tr><td>standard</td><td>cluster</td><td>udp</td><td>any</td><td>any</td><td>null</td><td>null</td></tr><tr><td>standard</td><td>cluster</td><td>tcp</td><td></td><td>(ignored)</td><td>tcp</td><td>null</td></tr><tr><td>standard</td><td>cluster</td><td>tcp</td><td>tcp</td><td>(ignored)</td><td>tcp</td><td>null</td></tr><tr><td>standard</td><td>cluster</td><td>tcp</td><td>http/https</td><td></td><td>TCP(&lt;=1.23) or http/https(>=1.24)</td><td>null(&lt;=1.23) or <code>/</code>(>=1.24)</td></tr><tr><td>standard</td><td>cluster</td><td>tcp</td><td>http/https</td><td><code>/custom-path</code></td><td>http/https</td><td><code>/custom-path</code></td></tr><tr><td>standard</td><td>cluster</td><td>tcp</td><td>unsupported protocol</td><td><code>/custom-path</code></td><td>tcp</td><td>null</td></tr><tr><td>basic</td><td>local</td><td>any</td><td>any</td><td>any</td><td>http</td><td><code>/healthz</code></td></tr><tr><td>basic</td><td>cluster</td><td>tcp</td><td></td><td>(ignored)</td><td>tcp</td><td>null</td></tr><tr><td>basic</td><td>cluster</td><td>tcp</td><td>tcp</td><td>(ignored)</td><td>tcp</td><td>null</td></tr><tr><td>basic</td><td>cluster</td><td>tcp</td><td>http</td><td></td><td>TCP(&lt;=1.23) or http/https(>=1.24)</td><td>null(&lt;=1.23) or <code>/</code>(>=1.24)</td></tr><tr><td>basic</td><td>cluster</td><td>tcp</td><td>http</td><td><code>/custom-path</code></td><td>http</td><td><code>/custom-path</code></td></tr><tr><td>basic</td><td>cluster</td><td>tcp</td><td>unsupported protocol</td><td><code>/custom-path</code></td><td>tcp</td><td>null</td></tr></tbody></table><p>Since v1.21, two service annotations <code>service.beta.kubernetes.io/azure-load-balancer-health-probe-interval</code> and <code>load-balancer-health-probe-num-of-probe</code> are introduced, which customize the configuration of health probe. If <code>service.beta.kubernetes.io/azure-load-balancer-health-probe-interval</code> is not set, Default value of 5 is applied. If <code>load-balancer-health-probe-num-of-probe</code> is not set, Default value of 2 is applied. And total probe should be less than 120 seconds.</p><h3 id=custom-load-balancer-health-probe-for-port>Custom Load Balancer health probe for port</h3><p>Because <a href=https://kubernetes.io/docs/concepts/services-networking/service/#load-balancers-with-mixed-protocol-types>MixedProtocolLBService</a> feature is in alpha stage, Ports in one service may have different probe configurations. Following annotations are introduced to customize probe configuration for one port.</p><table><thead><tr><th>port specific annotation</th><th>global probe annotation</th></tr></thead><tbody><tr><td>service.beta.kubernetes.io/port_{port}_health-probe_request-path</td><td>service.beta.kubernetes.io/azure-load-balancer-health-probe-request-path</td></tr><tr><td>service.beta.kubernetes.io/port_{port}_health-probe_num-of-probe</td><td>service.beta.kubernetes.io/azure-load-balancer-health-probe-num-of-probe</td></tr><tr><td>service.beta.kubernetes.io/port_{port}_health-probe_interval</td><td>service.beta.kubernetes.io/azure-load-balancer-health-probe-interval</td></tr></tbody></table><p>For following manifest, probe rule for port httpsserver is different from the one for httpserver because annoations for port httpsserver are specified.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Service</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>appservice</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>service.beta.kubernetes.io/azure-load-balancer-health-probe-num-of-probe</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;5&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>service.beta.kubernetes.io/port_443_health-probe_num-of-probe</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;4&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LoadBalancer</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>app</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>server</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>ports</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>httpserver</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>protocol</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TCP</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>80</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>targetPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>30102</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>httpsserver</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>protocol</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TCP</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>appProtocol</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HTTPS</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>port</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>443</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>targetPort</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>30104</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><h2 id=configure-load-balancer-backend>Configure Load Balancer backend</h2><blockquote><p>This feature is supported since v1.23.0</p></blockquote><p>The backend pool type can be configured by specifying <code>loadBalancerBackendPoolConfigurationType</code> in the cloud configuration file. There are three possible values:</p><ol><li><code>nodeIPConfiguration</code> (default). In this case we attach nodes to the LB by calling the VMSS/NIC API to associate the corresponding node IP configuration with the LB backend pool.</li><li><code>nodeIP</code>. In this case we attach nodes to the LB by calling the LB API to add the node private IP addresses to the LB backend pool.</li><li><code>podIP</code> (not supported yet). In this case we do not attach nodes to the LB. Instead we directly adding pod IPs to the LB backend pool.</li></ol><h2 id=load-balancer-limits>Load balancer limits</h2><p>The limits of the load balancer related resources are listed below:</p><p><strong>Standard Load Balancer</strong></p><table><thead><tr><th>Resource</th><th>Limit</th></tr></thead><tbody><tr><td>Load balancers</td><td>1,000</td></tr><tr><td>Rules per resource</td><td>1,500</td></tr><tr><td>Rules per NIC (across all IPs on a NIC)</td><td>300</td></tr><tr><td>Frontend IP configurations</td><td>600</td></tr><tr><td>Backend pool size</td><td>1,000 IP configurations, single virtual network</td></tr><tr><td>Backend resources per Load Balancer</td><td>150</td></tr><tr><td>High-availability ports</td><td>1 per internal frontend</td></tr><tr><td>Outbound rules per Load Balancer</td><td>600</td></tr><tr><td>Load Balancers per VM</td><td>2 (1 Public and 1 internal)</td></tr></tbody></table><p>The limit is up to 150 resources, in any combination of standalone virtual machine resources, availability set resources, and virtual machine scale-set placement groups.</p><p><strong>Basic Load Balancer</strong></p><table><thead><tr><th>Resource</th><th>Limit</th></tr></thead><tbody><tr><td>Load balancers</td><td>1,000</td></tr><tr><td>Rules per resource</td><td>250</td></tr><tr><td>Rules per NIC (across all IPs on a NIC)</td><td>300</td></tr><tr><td>Frontend IP configurations</td><td>200</td></tr><tr><td>Backend pool size</td><td>300 IP configurations, single availability set</td></tr><tr><td>Availability sets per Load Balancer</td><td>1</td></tr><tr><td>Load Balancers per VM</td><td>2 (1 Public and 1 internal)</td></tr></tbody></table><blockquote><p>There is a restriction of 300 rules per NIC, hence for single SLB mode 300 services are allowed at most. If more services are required, try to enable <a href=../multiple-slb>multiple SLBs</a>.</p></blockquote><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/USERNAME/REPOSITORY/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/USERNAME/REPOSITORY/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector('.feedback--answer-yes'),noButton=document.querySelector('.feedback--answer-no'),yesResponse=document.querySelector('.feedback--response-yes'),noResponse=document.querySelector('.feedback--response-no'),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=b=>{if(typeof ga!='function')return;const a={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:b};ga(a.command,a.hitType,a.category,a.action,a.label,a.value)};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(1)}),noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified
June 14, 2022
: <a href=https://github.com/kubernetes-sigs/cloud-provider-azure/commit/355614cc6aeb628a4905aafd12a95f87bac3dde8>Generate PIP name by loadbalancer (355614cc6)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Google Group" aria-label="Google Group"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/forum/#!forum/kubernetes-sig-cloud-provider aria-label="Google Group"><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/kubernetes-sigs/cloud-provider-azure aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The Kubernetes Authors All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/js/main.min.3b172c13b62c2bea8b1c9d2599cddc8cf89718a92d792c680871c81ba43d8c85.js integrity="sha256-OxcsE7YsK+qLHJ0lmc3cjPiXGKkteSxoCHHIG6Q9jIU=" crossorigin=anonymous></script></body></html>